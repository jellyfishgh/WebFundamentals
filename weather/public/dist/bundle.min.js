!function(){"use strict";var app={isLoading:!0,visibleCards:{},selectedCities:[],spinner:document.querySelector(".loader"),cardTemplate:document.querySelector(".cardTemplate"),container:document.querySelector(".main"),addDialog:document.querySelector(".dialog-container"),daysOfWeek:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]};document.getElementById("butRefresh").addEventListener("click",function(){app.updateForecasts()}),document.getElementById("butAdd").addEventListener("click",function(){app.toggleAddDialog(!0)}),document.getElementById("butAddCity").addEventListener("click",function(){var select=document.getElementById("selectCityToAdd"),selected=select.options[select.selectedIndex],key=selected.value,label=selected.textContent;app.getForecast(key,label),app.selectedCities.push({key:key,label:label}),app.toggleAddDialog(!1)}),document.getElementById("butAddCancel").addEventListener("click",function(){app.toggleAddDialog(!1)}),app.toggleAddDialog=function(visible){visible?app.addDialog.classList.add("dialog-container--visible"):app.addDialog.classList.remove("dialog-container--visible")},app.updateForecastCard=function(data){var card=app.visibleCards[data.key];card||(card=app.cardTemplate.cloneNode(!0),card.classList.remove("cardTemplate"),card.querySelector(".location").textContent=data.label,card.removeAttribute("hidden"),app.container.appendChild(card),app.visibleCards[data.key]=card),card.querySelector(".description").textContent=data.currently.summary,card.querySelector(".date").textContent=new Date(1e3*data.currently.time),card.querySelector(".current .icon").classList.add(data.currently.icon),card.querySelector(".current .temperature .value").textContent=Math.round(data.currently.temperature),card.querySelector(".current .feels-like .value").textContent=Math.round(data.currently.apparentTemperature),card.querySelector(".current .precip").textContent=Math.round(100*data.currently.precipProbability)+"%",card.querySelector(".current .humidity").textContent=Math.round(100*data.currently.humidity)+"%",card.querySelector(".current .wind .value").textContent=Math.round(data.currently.windSpeed),card.querySelector(".current .wind .direction").textContent=data.currently.windBearing;var nextDays=card.querySelectorAll(".future .oneday"),today=new Date;today=today.getDay();for(var i=0;7>i;i++){var nextDay=nextDays[i],daily=data.daily.data[i];daily&&nextDay&&(nextDay.querySelector(".date").textContent=app.daysOfWeek[(i+today)%7],nextDay.querySelector(".icon").classList.add(daily.icon),nextDay.querySelector(".temp-high .value").textContent=Math.round(daily.temperatureMax),nextDay.querySelector(".temp-low .value").textContent=Math.round(daily.temperatureMin))}app.isLoading&&(app.spinner.setAttribute("hidden",!0),app.container.removeAttribute("hidden"),app.isLoading=!1)},app.getForecast=function(key,label){var url="https://publicdata-weather.firebaseio.com/";url+=key+".json";var request=new XMLHttpRequest;request.onreadystatechange=function(){if(request.readyState===XMLHttpRequest.DONE&&200===request.status){var response=JSON.parse(request.response);response.key=key,response.label=label,app.hasRequestPending=!1,app.updateForecastCard(response)}},request.open("GET",url),request.send()},app.updateForecasts=function(){var keys=Object.keys(app.visibleCards);keys.forEach(function(key){app.getForecast(key)})};var fakeForecast={key:"newyork",label:"New York, NY",currently:{time:1453489481,summary:"Clear",icon:"partly-cloudy-day",temperature:30,apparentTemperature:21,precipProbability:.8,humidity:.17,windBearing:125,windSpeed:1.52},daily:{data:[{icon:"clear-day",temperatureMax:36,temperatureMin:31},{icon:"rain",temperatureMax:34,temperatureMin:28},{icon:"snow",temperatureMax:31,temperatureMin:17},{icon:"sleet",temperatureMax:38,temperatureMin:31},{icon:"fog",temperatureMax:40,temperatureMin:36},{icon:"wind",temperatureMax:35,temperatureMin:29},{icon:"partly-cloudy-day",temperatureMax:42,temperatureMin:40}]}};app.updateForecastCard(fakeForecast)}();